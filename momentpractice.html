<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Train time table</title>
	<!-- Latest compiled and minified CSS & JS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
	<!-- moment.js CDN for calculating time in javascript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.0/moment.min.js"></script>

    <style>
    	.mywell {
    		background-color: skyblue;
    	}
    </style>
</head>
<body>
<div class="container">
	<div class="row">
		<div class="well mywell text-center">
			<h2>All aboard!</h2>
		</div>
	</div>
	<div class="row">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<div class="panel-title">Current train schedule</div>
			</div>
			<div class="panel-body">
				<table id="trainTable" class="table">
					<thead>
						<tr>
							<th scope="col">Train name</th>
							<th scope="col">Destination</th>
							<th scope="col">Frequency (min)</th>
							<th scope="col">Next arrival</th>
							<th scope="col">Minutes away</th>
						</tr>
					</thead>
					<tbody id="tableBody">
						
					</tbody>
				</table>
			</div>
		</div> <!-- END panel-primary -->

		<div class="panel-primary panel">
			<div class="panel-heading">
				<div class="panel-title">Add train</div>
			</div>
			<div class="panel-body">
				<label for="trainName">Train Name</label>
				<input type="text" id="trainName" class="form-control"><br>
				<label for="destination">Destination</label>
				<input type="text" id="destination" class="form-control"><br>
				<label for="firstTrainTime">First Train Time (HH:mm - military time)</label>
				<input type="text" id="firstTrainTime" class="form-control"><br>
				<label for="frequency">Frequency</label>
				<input type="text" id="frequency" class="form-control"><br>
				<button id="submitBtn" type="submit" class="btn-primary btn">Submit</button>
			</div>
		</div><!--  END panel-primary -->
	</div>
</div>

<script>

// Initialize Firebase
var config = {
apiKey: "AIzaSyB6G5uduex9bGt2N9oRZOh_xQXkADI11Ik",
authDomain: "traintimetable-a89a2.firebaseapp.com",
databaseURL: "https://traintimetable-a89a2.firebaseio.com",
storageBucket: "",
messagingSenderId: "819328224143"
};
firebase.initializeApp(config);

//Assigns the firebase database to a variable
var database = firebase.database();

var currentTime = moment(new Date());

// alert(currentTime);
var startTime = '12:30';



//When user submits the data,
$('#submitBtn').on('click', function() {

	//User input is assigned to the following variables
	var trainName = $('#trainName').val().trim();
	var destination = $('#destination').val().trim();
	var firstTrainTime = $('#firstTrainTime').val().trim();
	var frequency = $('#frequency').val().trim();


	console
	// console.log(trainName);

	//Create a new object that will be pushed to Firebase.
	var newTrain = {
		name: trainName,
		destin: destination,
		firstTrain: firstTrainTime,
		freq: frequency
	}


	//Adds, or pushes, the newTrain object to the existing Firebase database
	database.ref().push(newTrain);

	//Empties out the values held in variables before the next entry
	$('#trainName').val('');
	$('#destination').val('');
	$('#firstTrainTime').val('');
	$('#frequency').val('');

	// console.log('Updated trainname: ' + $('#trainName').val());

	//Prevents the page from refreshing and erasing updated content
	return false;
})

//The following executes when an object is pushed, i.e. child is added, to Firebase database.
database.ref().on('child_added', function(childSnapshot){
	// console.log(childSnapshot.val());

	//Data elements from Firebase are assigned to variables before dumping them to HTML
	var fbName = childSnapshot.val().name;
	var fbDestin = childSnapshot.val().destin;
	var fbFirstTrain = childSnapshot.val().firstTrain;
	var fbFreq = childSnapshot.val().freq;

	console.log('fbFirstTrain: '+fbFirstTrain);

	// var currentTime = moment(new Date());
	// currentTime = moment(currentTime).format('HH:mm');
	// // console.log(currentTime);

	// var startTime = moment(new Date(fbFirstTrain));
	// // console.log('start time: ' + startTime);
	

	//Dumps newly pushed Firebase data to HTML
	$('#trainTable > tbody').append(
		'<tr>' +
		'<td>' + fbName + '</td>' +
		'<td>' + fbDestin + '</td>' +
		'<td>' + fbFreq + '</td>' +
		'<td>' + fbFirstTrain + '</td>' +
		
		'</tr>'
	);
})

</script>	
</body>
</html>